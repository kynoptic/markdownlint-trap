#!/bin/sh
# Pre-push hook to ensure build artifacts are current and quality gates pass

echo "🔍 Running pre-push quality checks..."

# Check if build artifacts are up to date
echo "📦 Checking build artifacts..."
if ! npm run build --silent 2>/dev/null; then
    echo "❌ Build failed"
    exit 1
fi

# Check for uncommitted changes after build (indicates stale artifacts)
if ! git diff --exit-code --quiet .markdownlint-rules/; then
    echo "❌ Build artifacts are out of sync with source code"
    echo "   Run 'npm run build' and commit the changes"
    git diff --name-only .markdownlint-rules/
    exit 1
fi

# Ensure all tests pass before pushing
echo "🧪 Running test suite..."
if ! npm test --silent; then
    echo "❌ Tests failed"
    exit 1
fi

# Ensure linting passes
echo "🔍 Running linter..."
if ! npm run lint --silent; then
    echo "❌ Linting failed"
    exit 1
fi

echo "✅ All pre-push checks passed"