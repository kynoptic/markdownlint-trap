#!/bin/sh
# Pre-push hook to ensure build artifacts are current and quality gates pass

echo "ğŸ” Running pre-push quality checks..."

# Check if build artifacts are up to date
echo "ğŸ“¦ Checking build artifacts..."
if ! npm run build --silent 2>/dev/null; then
    echo "âŒ Build failed"
    exit 1
fi

# Check for uncommitted changes after build (indicates stale artifacts)
if ! git diff --exit-code --quiet .markdownlint-rules/; then
    echo "âŒ Build artifacts are out of sync with source code"
    echo "   Run 'npm run build' and commit the changes"
    git diff --name-only .markdownlint-rules/
    exit 1
fi

# Ensure all tests pass before pushing
echo "ğŸ§ª Running test suite..."
if ! npm test --silent; then
    echo "âŒ Tests failed"
    exit 1
fi

# Ensure linting passes
echo "ğŸ” Running linter..."
if ! npm run lint --silent; then
    echo "âŒ Linting failed"
    exit 1
fi

echo "âœ… All pre-push checks passed"